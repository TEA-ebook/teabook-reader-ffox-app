{"absId":"collection/ebooks","url":"/Users/johanpoirier/workspace/firefoxos/teabook-reader-app/app/js/collection/ebooks.js","source":"define(\"collection/ebooks\", [\"backbone\", \"model/ebook\"], function (Backbone, EbookModel) {\n    \"use strict\";\n\n    var EbookCollection = Backbone.Collection.extend({\n\n        model: EbookModel,\n\n        fetch: function () {\n            var ebooks = [];\n            if (navigator && navigator.getDeviceStorage) {\n                var ebookFiles = navigator.getDeviceStorage('sdcard');\n\n                // Let's browse all the images available\n                var cursor = ebookFiles.enumerate(\"books\");\n\n                var collection = this;\n                cursor.onsuccess = function () {\n                    var file = this.result;\n                    if (file) {\n                        ebooks.push(new EbookModel({\n                            name: file.name,\n                            size: file.size\n                        }));\n                    }\n\n                    if (!this.done) {\n                        this.continue();\n                    }\n                    else {\n                        collection.reset(ebooks);\n                    }\n                };\n\n                cursor.onerror = function () {\n                    console.warn(\"No ebook file found: \" + this.error);\n                };\n            }\n            else {\n                console.warn(\"You have no SD card access\");\n                for(var i = 0; i < 10; i++) {\n                    ebooks.push(new EbookModel({\n                        name: \"FakeFile-\" + i,\n                        size: 0\n                    }));\n                }\n                this.reset(ebooks);\n            }\n        }\n    });\n\n    return EbookCollection;\n});","modules":[{"pos":0,"count":89,"id":"collection/ebooks","depList":["backbone","model/ebook"],"factory":true,"argList":["Backbone","EbookModel"]}],"compileTime":"2014-10-20T09:32:40.962Z"}